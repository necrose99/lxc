#!/bin/bash
#### Horridly cobbled together By Mike Lawrence. Necrose99
## Cleanup contributors welcome. 
#
# LXC template for Pentoo (gentoo Varrient) 
#### To do add selection of Pentoo Profiles 
## Idea is for making ones own Pentoo or related package build server as a service 
# and not melting down local machine doing tests or as A Security Applince base for building IT Security related testing tools.
# IE Vagrant-LXC etc...
### as well We Borrow much code from Pentoo https://github.com/Spike-Pentesting/App-witchcraft and use CI
### if somethings wrong having a pentoo in a box may help us fix/contribute back it and share results back. 

include Gentoo.lxc 
## Pentoo is a Gentoo Based Security Testing O/S , add Pentoo-($name$) to container my bash foo sucks
## make a generic Gentoo container with Pentoo as name and $ARCH 
### ADD Layman add pentoo Overlay then "Convert to Pentoo" 
# Pentoo is just a Gentoo Flavoring however having LXC build it a plus for making a victum build/testing container. 
USE="bazaar cvs darcs +git gpg g-sorcery mercurial squashfs subversion sync-plugin-portage test" Emerge layman
#@ Build layman to add overlay of pentoo. 
#echo ${Fetch the layman list of overlays.... } 
layman -L
#echo ${now adding Pentoo to your Gentoo LXC container & "Converting"} 
Layman -a pentoo 
### Add Pentoo overlay to portage 

# eleslect profile search and select .... Arch-default amd64  
### so some magical??? 
### code to wrap elselect profile to a desired profile --- This step eludes me. 
###
## numbers varry depending on Overlay  for sake of speed binary and then build new packages against.  
## Hardened or the defatco or one could set the symlink by force. one can change this latter. 
# {some choice for arch} or hardened arch {hear} 
# x86 much the same.... 
  # default/linux/uclibc/amd64
 ##   pentoo:pentoo/default/linux/amd64
  #  pentoo:pentoo/default/linux/amd64/binary
#   **** pentoo:pentoo/default/linux/amd64/bleeding_edge
# pentoo:pentoo/hardened/linux/amd64
#  pentoo:pentoo/hardened/linux/amd64/binary
#**  pentoo:pentoo/hardened/linux/amd64/bleeding_edge
  
  # This will become the pentoo-updater script soon goten from Pentoo updater script/s

# This syncs the gentoo and pentoo repos like "apt-get update" in debian
emerge --sync
# This updates all the normal packages like "apt-get upgrade" in debian
emerge --deep --update --newuse world -vt
# This optionally merges in changed config files. unchanged files are merged automatically
etc-update
# This removes old packages which are not needed like "apt-get autoremove" in debian
emerge --depclean
# This rebuilds anything which may have been broken in update
emerge @preserved-rebuild
# This checks all the programs installed from VCS for new revisions and updates if needed
smart-live-rebuild
# Verifies there is no breakage after updates
revdep-rebuild
#merge in any new config files
etc-update
#clean up the distfiles/packages dirs to remove old/un-needed files
eclean-dist -d && eclean-pkg -d
# Check /var/log/portage/elog/summary.log file
# You might need to run extra commands. For example:
emerge @x11-module-rebuild
eselect java-vm set system icedtea-bin-7

# Run the following command under each regular user's account  makes the menus for X11 
# Regenerate the main menu for XFCE WM (or "-e" for e17, "-k" for KDE)
genmenu.py -x 

### some grovy code to pipe x11 to ssh for a user/s 
